<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EduAI Principal Dashboard - Student Assessment</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        .text-gradient {
            background: linear-gradient(to right, #6366f1, #a855f7);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .gradient-main {
            background-image: linear-gradient(to right, #6366f1, #a855f7);
        }

        .main-shadow {
            box-shadow: 0 10px 15px -3px rgba(99, 102, 241, 0.2), 0 4px 6px -2px rgba(99, 102, 241, 0.1);
        }

        .assessment-card {
            transition: all 0.3s ease;
        }

        .assessment-card:hover {
            transform: translateY(-5px);
        }

        .progress-bar {
            height: 8px;
            border-radius: 4px;
            overflow: hidden;
        }

        .baseline-color {
            background-color: #6366f1;
        }

        .midline-color {
            background-color: #8b5cf6;
        }

        .endline-color {
            background-color: #a855f7;
        }

        .improvement-positive {
            color: #10b981;
        }

        .improvement-negative {
            color: #ef4444;
        }

        /* Mobile hamburger menu */
        .mobile-menu {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.9);
            z-index: 1000;
            padding: 20px;
        }

        .mobile-menu.active {
            display: block;
        }

        /* Responsive table */
        @media (max-width: 768px) {
            .responsive-table {
                display: block;
                overflow-x: auto;
                white-space: nowrap;
            }

            .mobile-stack {
                flex-direction: column;
            }

            .mobile-full {
                width: 100%;
            }

            .mobile-p-4 {
                padding: 1rem;
            }

            .mobile-text-center {
                text-align: center;
            }

            .mobile-mb-4 {
                margin-bottom: 1rem;
            }
        }
    </style>
</head>

<body class="bg-gray-900 text-gray-100 min-h-screen">

    <!-- Top Navigation Bar -->
    <nav class="bg-gray-800 shadow-xl fixed top-0 left-0 right-0 z-50">
        <div class="container mx-auto px-4">
            <div class="flex items-center justify-between h-16">
                <!-- Logo -->
                <div class="flex items-center space-x-3">
                    <span class="text-2xl font-extrabold text-gradient">EduAI</span>
                    <span class="text-lg font-light text-gray-400 hidden md:block">Principal Dashboard</span>
                </div>

                <!-- Desktop Navigation -->
                <div class="hidden md:flex items-center space-x-1">
                    <button onclick="changeView('dashboard')" id="nav-dashboard"
                        class="nav-item px-4 py-2 rounded-lg hover:bg-gray-700 transition duration-150 text-sm font-medium">
                        <i data-lucide="layout-dashboard" class="w-4 h-4 inline mr-2"></i>
                        Dashboard
                    </button>
                    <button onclick="changeView('students')" id="nav-students"
                        class="nav-item px-4 py-2 rounded-lg hover:bg-gray-700 transition duration-150 text-sm font-medium">
                        <i data-lucide="graduation-cap" class="w-4 h-4 inline mr-2"></i>
                        Students
                    </button>
                    <button onclick="changeView('staff')" id="nav-staff"
                        class="nav-item px-4 py-2 rounded-lg hover:bg-gray-700 transition duration-150 text-sm font-medium">
                        <i data-lucide="users-round" class="w-4 h-4 inline mr-2"></i>
                        Staff
                    </button>
                    <button onclick="changeView('progress')" id="nav-progress"
                        class="nav-item px-4 py-2 rounded-lg hover:bg-gray-700 transition duration-150 text-sm font-medium">
                        <i data-lucide="trending-up" class="w-4 h-4 inline mr-2"></i>
                        Progress
                    </button>
                    <button onclick="changeView('assessments')" id="nav-assessments"
                        class="nav-item px-4 py-2 rounded-lg hover:bg-gray-700 transition duration-150 text-sm font-medium">
                        <i data-lucide="clipboard-check" class="w-4 h-4 inline mr-2"></i>
                        Assessments
                    </button>
                    <button onclick="changeView('ai-education')" id="nav-ai-education"
                        class="nav-item px-4 py-2 rounded-lg hover:bg-gray-700 transition duration-150 text-sm font-medium">
                        <i data-lucide="brain" class="w-4 h-4 inline mr-2"></i>
                        AI Education
                    </button>
                </div>

                <!-- Mobile Menu Button -->
                <button id="mobile-menu-button" class="md:hidden p-2 rounded-lg bg-gray-700 text-white">
                    <i data-lucide="menu" class="w-6 h-6"></i>
                </button>
            </div>
        </div>
    </nav>

    <!-- Mobile Menu Overlay -->
    <div id="mobile-menu" class="mobile-menu">
        <div class="flex justify-between items-center mb-8">
            <span class="text-2xl font-extrabold text-gradient">EduAI</span>
            <button id="close-mobile-menu" class="p-2 rounded-lg bg-gray-700 text-white">
                <i data-lucide="x" class="w-6 h-6"></i>
            </button>
        </div>
        <div class="space-y-2">
            <button onclick="changeView('dashboard')" id="mobile-nav-dashboard"
                class="nav-item w-full text-left px-4 py-3 rounded-lg hover:bg-gray-700 transition duration-150 text-lg font-medium flex items-center">
                <i data-lucide="layout-dashboard" class="w-5 h-5 mr-3"></i>
                Dashboard
            </button>
            <button onclick="changeView('students')" id="mobile-nav-students"
                class="nav-item w-full text-left px-4 py-3 rounded-lg hover:bg-gray-700 transition duration-150 text-lg font-medium flex items-center">
                <i data-lucide="graduation-cap" class="w-5 h-5 mr-3"></i>
                Students
            </button>
            <button onclick="changeView('staff')" id="mobile-nav-staff"
                class="nav-item w-full text-left px-4 py-3 rounded-lg hover:bg-gray-700 transition duration-150 text-lg font-medium flex items-center">
                <i data-lucide="users-round" class="w-5 h-5 mr-3"></i>
                Staff
            </button>
            <button onclick="changeView('progress')" id="mobile-nav-progress"
                class="nav-item w-full text-left px-4 py-3 rounded-lg hover:bg-gray-700 transition duration-150 text-lg font-medium flex items-center">
                <i data-lucide="trending-up" class="w-5 h-5 mr-3"></i>
                Progress
            </button>
            <button onclick="changeView('assessments')" id="mobile-nav-assessments"
                class="nav-item w-full text-left px-4 py-3 rounded-lg hover:bg-gray-700 transition duration-150 text-lg font-medium flex items-center">
                <i data-lucide="clipboard-check" class="w-5 h-5 mr-3"></i>
                Assessments
            </button>
            <button onclick="changeView('ai-education')" id="mobile-nav-ai-education"
                class="nav-item w-full text-left px-4 py-3 rounded-lg hover:bg-gray-700 transition duration-150 text-lg font-medium flex items-center">
                <i data-lucide="brain" class="w-5 h-5 mr-3"></i>
                AI Education
            </button>
        </div>
    </div>

    <!-- Main Content -->
    <main class="pt-20 pb-8 px-4 md:px-8">
        <h1 class="text-3xl font-bold mb-6 text-gray-200" id="page-title">Loading Dashboard...</h1>
        <div id="view-content" class="min-h-[500px]">
            <div class="flex justify-center items-center h-full">
                <div class="animate-spin rounded-full h-12 w-12 border-b-2 border-indigo-500"></div>
            </div>
        </div>
    </main>

    <!-- Global Message Modal -->
    <div id="message-modal"
        class="hidden fixed inset-0 bg-gray-900 bg-opacity-75 z-50 flex justify-center items-center p-4">
        <div class="bg-gray-800 p-6 rounded-xl shadow-2xl main-shadow max-w-sm w-full border border-gray-700">
            <h3 id="modal-title" class="text-xl font-bold mb-3 text-indigo-400"></h3>
            <p id="modal-body" class="text-gray-300 mb-6 text-sm"></p>
            <div class="flex justify-end space-x-3">
                <button id="modal-cancel-btn"
                    class="hidden px-4 py-2 text-sm font-medium text-gray-300 bg-gray-700 rounded-lg hover:bg-gray-600 transition">Cancel</button>
                <button id="modal-confirm-btn"
                    class="px-4 py-2 text-sm font-medium text-white gradient-main rounded-lg hover:opacity-90 transition">OK</button>
            </div>
        </div>
    </div>

    <script>
        // App state
        let appState = {
            currentView: 'dashboard',
            stats: {
                total_students: 0,
                total_staff: 0,
                attendance_rate: 0,
                academic_performance: 0,
                last_updated: new Date().toISOString()
            },
            students: [],
            staff: [],
            progress: {
                overview: {},
                chart: null,
                subjects: []
            },
            assessments: {
                baseline: [],
                midline: [],
                endline: [],
                studentProgress: []
            }
        };

        // Initialize from localStorage
        function initializeAppState() {
            const savedState = localStorage.getItem('eduai-dashboard-data');
            if (savedState) {
                const parsedState = JSON.parse(savedState);
                appState.students = parsedState.students || [];
                appState.staff = parsedState.staff || [];
                appState.assessments = parsedState.assessments || {
                    baseline: [], midline: [], endline: [], studentProgress: []
                };
                updateStats();
            } else {
                loadInitialData();
            }
        }

        function saveAppState() {
            const stateToSave = {
                students: appState.students,
                staff: appState.staff,
                assessments: appState.assessments
            };
            localStorage.setItem('eduai-dashboard-data', JSON.stringify(stateToSave));
            updateStats();
        }

        function resetData() {
            showModal("Reset Data", "Are you sure you want to reset all data? This cannot be undone.", true)
                .then(confirmed => {
                    if (confirmed) {
                        localStorage.removeItem('eduai-dashboard-data');
                        initializeAppState();
                        loadData();
                        showModal("Success", "All data has been reset to initial values.");
                    }
                });
        }

        function updateStats() {
            appState.stats.total_students = appState.students.length;
            appState.stats.total_staff = appState.staff.length;

            if (appState.students.length > 0) {
                const totalAttendance = appState.students.reduce((sum, student) => sum + (student.attendance || 0), 0);
                appState.stats.attendance_rate = totalAttendance / appState.students.length;

                const totalScores = appState.students.reduce((sum, student) => sum + (student.overall_score || 0), 0);
                appState.stats.academic_performance = totalScores / appState.students.length;
            }
            appState.stats.last_updated = new Date().toISOString();
        }

        function loadInitialData() {
            appState.students = [
                { id: 1, name: "Emma Johnson", grade: 10, overall_score: 92, attendance: 96 },
                { id: 2, name: "Noah Williams", grade: 9, overall_score: 85, attendance: 92 },
                { id: 3, name: "Olivia Brown", grade: 11, overall_score: 78, attendance: 88 },
                { id: 4, name: "Liam Jones", grade: 10, overall_score: 91, attendance: 95 },
                { id: 5, name: "Ava Garcia", grade: 9, overall_score: 87, attendance: 90 }
            ];

            appState.staff = [
                { id: 1, name: "Dr. Sarah Mitchell", role: "Math Teacher", department: "Mathematics" },
                { id: 2, name: "Mr. James Wilson", role: "Science Teacher", department: "Science" },
                { id: 3, name: "Ms. Emily Chen", role: "English Teacher", department: "Language Arts" },
                { id: 4, name: "Dr. Robert Taylor", role: "History Teacher", department: "Social Studies" },
                { id: 5, name: "Mrs. Lisa Anderson", role: "Art Teacher", department: "Fine Arts" }
            ];

            appState.assessments.studentProgress = [
                { id: 1, name: "Emma Johnson", grade: 10, baseline_score: 85, midline_score: 89, endline_score: 92 },
                { id: 2, name: "Noah Williams", grade: 9, baseline_score: 78, midline_score: 82, endline_score: 85 },
                { id: 3, name: "Olivia Brown", grade: 11, baseline_score: 72, midline_score: 75, endline_score: 78 },
                { id: 4, name: "Liam Jones", grade: 10, baseline_score: 88, midline_score: 90, endline_score: 91 },
                { id: 5, name: "Ava Garcia", grade: 9, baseline_score: 80, midline_score: 84, endline_score: 87 }
            ];

            updateStats();
            saveAppState();
        }

        const viewContent = document.getElementById('view-content');
        const pageTitle = document.getElementById('page-title');

        // Modal functions
        let resolveModalPromise = null;

        function showModal(title, body, isConfirm = false) {
            return new Promise((resolve) => {
                resolveModalPromise = resolve;
                const modal = document.getElementById('message-modal');
                document.getElementById('modal-title').textContent = title;
                document.getElementById('modal-body').textContent = body;

                const okBtn = document.getElementById('modal-confirm-btn');
                const cancelBtn = document.getElementById('modal-cancel-btn');

                if (isConfirm) {
                    okBtn.textContent = 'Confirm';
                    okBtn.onclick = () => { closeModal(); resolve(true); };
                    cancelBtn.classList.remove('hidden');
                    cancelBtn.onclick = () => { closeModal(); resolve(false); };
                } else {
                    okBtn.textContent = 'OK';
                    okBtn.onclick = () => { closeModal(); resolve(true); };
                    cancelBtn.classList.add('hidden');
                }

                modal.classList.remove('hidden');
            });
        }

        function closeModal() {
            document.getElementById('message-modal').classList.add('hidden');
            if (resolveModalPromise) {
                resolveModalPromise(false);
                resolveModalPromise = null;
            }
        }

        // Mobile menu handling
        function setupMobileMenu() {
            const mobileMenuButton = document.getElementById('mobile-menu-button');
            const closeMobileMenuButton = document.getElementById('close-mobile-menu');
            const mobileMenu = document.getElementById('mobile-menu');

            mobileMenuButton.addEventListener('click', () => {
                mobileMenu.classList.add('active');
            });

            closeMobileMenuButton.addEventListener('click', () => {
                mobileMenu.classList.remove('active');
            });

            // Close mobile menu when clicking on a nav item
            document.querySelectorAll('#mobile-menu .nav-item').forEach(item => {
                item.addEventListener('click', () => {
                    mobileMenu.classList.remove('active');
                });
            });
        }

        // Load data for current view
        async function loadData() {
            viewContent.innerHTML = '<div class="flex justify-center items-center h-full min-h-[500px]"><div class="animate-spin rounded-full h-12 w-12 border-b-2 border-indigo-500"></div></div>';

            switch (appState.currentView) {
                case 'dashboard':
                    appState.progress.overview = await fetchMockData('/progress/overview');
                    appState.progress.chart = await fetchMockData('/progress/chart');
                    break;
                case 'students':
                case 'staff':
                    break;
                case 'progress':
                    appState.progress.subjects = await fetchMockData('/progress/subjects');
                    appState.progress.chart = await fetchMockData('/progress/chart');
                    appState.progress.overview = await fetchMockData('/progress/overview');
                    break;
                case 'assessments':
                    appState.assessments.baseline = await fetchMockData('/assessments/baseline');
                    appState.assessments.midline = await fetchMockData('/assessments/midline');
                    appState.assessments.endline = await fetchMockData('/assessments/endline');
                    break;
                case 'ai-education':
                    break;
            }
            renderApp();
        }

        async function fetchMockData(endpoint) {
            await new Promise(resolve => setTimeout(resolve, 300));

            switch (endpoint) {
                case '/progress/overview':
                    return {
                        average_grade: 78.5,
                        completion_rate: 92.3,
                        top_performer: appState.students.length > 0 ?
                            appState.students.reduce((prev, current) =>
                                (prev.overall_score > current.overall_score) ? prev : current).name : "N/A",
                        improvement_rate: 12.7
                    };
                case '/progress/chart':
                    return {
                        labels: ['Math', 'Science', 'English', 'History', 'Art'],
                        datasets: [{
                            label: 'Average Score',
                            data: [85, 78, 82, 75, 88],
                            backgroundColor: [
                                'rgba(99, 102, 241, 0.7)',
                                'rgba(139, 92, 246, 0.7)',
                                'rgba(168, 85, 247, 0.7)',
                                'rgba(217, 70, 239, 0.7)',
                                'rgba(236, 72, 153, 0.7)'
                            ],
                            borderColor: [
                                'rgb(99, 102, 241)',
                                'rgb(139, 92, 246)',
                                'rgb(168, 85, 247)',
                                'rgb(217, 70, 239)',
                                'rgb(236, 72, 153)'
                            ],
                            borderWidth: 1
                        }]
                    };
                case '/progress/subjects':
                    return [
                        { name: "Mathematics", teacher: "Dr. Sarah Mitchell", average: 85.2, improvement: 8.5 },
                        { name: "Science", teacher: "Mr. James Wilson", average: 78.7, improvement: 12.3 },
                        { name: "English", teacher: "Ms. Emily Chen", average: 82.1, improvement: 5.2 },
                        { name: "History", teacher: "Dr. Robert Taylor", average: 75.8, improvement: 3.7 },
                        { name: "Art", teacher: "Mrs. Lisa Anderson", average: 88.4, improvement: 15.1 }
                    ];
                case '/assessments/baseline':
                    return appState.students.map(student => ({
                        id: student.id,
                        name: student.name,
                        completed: Math.random() > 0.2
                    }));
                case '/assessments/midline':
                    return appState.students.map(student => ({
                        id: student.id,
                        name: student.name,
                        completed: Math.random() > 0.3
                    }));
                case '/assessments/endline':
                    return appState.students.map(student => ({
                        id: student.id,
                        name: student.name,
                        completed: Math.random() > 0.15
                    }));
                default:
                    return {};
            }
        }

        function changeView(newView) {
            appState.currentView = newView;

            // Update desktop navigation active state
            document.querySelectorAll('.nav-item').forEach(btn => {
                btn.classList.remove('bg-indigo-700', 'text-white', 'main-shadow');
            });

            // Update both desktop and mobile nav
            document.getElementById(`nav-${newView}`)?.classList.add('bg-indigo-700', 'text-white', 'main-shadow');
            document.getElementById(`mobile-nav-${newView}`)?.classList.add('bg-indigo-700', 'text-white', 'main-shadow');

            const titles = {
                'dashboard': 'Dashboard Overview',
                'students': 'Student Management',
                'staff': 'Staff Directory',
                'progress': 'Academic Progress',
                'assessments': 'Assessment Results',
                'ai-education': 'AI in Early Education'
            };

            pageTitle.textContent = titles[newView] || newView.charAt(0).toUpperCase() + newView.slice(1);
            loadData();
        }

        function renderApp() {
            viewContent.innerHTML = '';

            switch (appState.currentView) {
                case 'dashboard':
                    renderDashboard();
                    break;
                case 'students':
                    renderStudents();
                    break;
                case 'staff':
                    renderStaff();
                    break;
                case 'progress':
                    renderProgress();
                    break;
                case 'assessments':
                    renderAssessments();
                    break;
                case 'ai-education':
                    renderAIEducation();
                    break;
            }
            lucide.createIcons();
        }

        // View rendering functions
        function renderCard(title, value, icon, color) {
            return `
                <div class="bg-gray-800 p-6 rounded-xl shadow-lg border border-gray-700 transition duration-300 hover:scale-[1.01] hover:shadow-indigo-900/50">
                    <div class="flex items-center justify-between">
                        <div class="text-sm font-medium text-gray-400">${title}</div>
                        <i data-lucide="${icon}" class="w-6 h-6 text-${color}-400"></i>
                    </div>
                    <div class="mt-4 text-3xl font-extrabold text-white">${value}</div>
                </div>
            `;
        }

        function renderDashboard() {
            const stats = appState.stats || {};
            const overview = appState.progress.overview || {};
            const chartData = appState.progress.chart;

            viewContent.innerHTML = `
                <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
                    ${renderCard("Total Students", stats.total_students || 0, "users", "indigo")}
                    ${renderCard("Total Staff", stats.total_staff || 0, "briefcase", "purple")}
                    ${renderCard("Attendance Rate", (stats.attendance_rate || 0).toFixed(1) + "%", "check-circle", "green")}
                    ${renderCard("Academic Performance", (stats.academic_performance || 0).toFixed(1) + "%", "bar-chart-2", "yellow")}
                </div>

                <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                    <div class="lg:col-span-2 bg-gray-800 p-6 rounded-xl shadow-lg border border-gray-700">
                        <h3 class="text-xl font-semibold mb-4 text-gray-200">Subject Average Scores</h3>
                        <div class="h-80">
                            <canvas id="average-scores-chart"></canvas>
                        </div>
                    </div>
                    <div class="bg-gray-800 p-6 rounded-xl shadow-lg border border-gray-700">
                        <h3 class="text-xl font-semibold mb-4 text-gray-200">AI Insights Overview</h3>
                        <div class="space-y-4">
                            <div class="flex items-center space-x-4 p-3 bg-gray-700/50 rounded-lg">
                                <div class="w-10 h-10 flex items-center justify-center bg-indigo-500-20 rounded-full">
                                    <i data-lucide="zap" class="w-5 h-5 text-indigo-400"></i>
                                </div>
                                <div>
                                    <div class="text-lg font-bold text-indigo-300">${(overview.average_grade || 0).toFixed(1)}%</div>
                                    <div class="text-sm text-gray-400">Average Grade</div>
                                </div>
                            </div>
                            <div class="flex items-center space-x-4 p-3 bg-gray-700/50 rounded-lg">
                                <div class="w-10 h-10 flex items-center justify-center bg-green-500-20 rounded-full">
                                    <i data-lucide="zap" class="w-5 h-5 text-green-400"></i>
                                </div>
                                <div>
                                    <div class="text-lg font-bold text-green-300">${(overview.completion_rate || 0).toFixed(1)}%</div>
                                    <div class="text-sm text-gray-400">Completion Rate</div>
                                </div>
                            </div>
                            <div class="flex items-center space-x-4 p-3 bg-gray-700/50 rounded-lg">
                                <div class="w-10 h-10 flex items-center justify-center bg-yellow-500-20 rounded-full">
                                    <i data-lucide="zap" class="w-5 h-5 text-yellow-400"></i>
                                </div>
                                <div>
                                    <div class="text-lg font-bold text-yellow-300">${overview.top_performer || "N/A"}</div>
                                    <div class="text-sm text-gray-400">Top Performer</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            `;

            if (chartData) {
                initializeChart(chartData);
            }
        }

        function renderStudents() {
            const students = appState.students || [];

            viewContent.innerHTML = `
                <div class="flex justify-between items-center mb-6">
                    <p class="text-sm text-gray-400">${students.length} students currently enrolled.</p>
                    <button onclick="showAddForm('student')" class="flex items-center space-x-2 px-4 py-2 text-sm font-medium text-white gradient-main rounded-xl hover:opacity-90 transition main-shadow">
                        <i data-lucide="plus" class="w-4 h-4"></i>
                        <span>Add Student</span>
                    </button>
                </div>
                ${renderAddStudentForm()}
                <div class="bg-gray-800 rounded-xl shadow-lg overflow-hidden border border-gray-700 responsive-table">
                    <table class="min-w-full divide-y divide-gray-700">
                        <thead class="bg-gray-700">
                            <tr>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-400 uppercase tracking-wider">ID</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-400 uppercase tracking-wider">Name</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-400 uppercase tracking-wider">Grade</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-400 uppercase tracking-wider">Score</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-400 uppercase tracking-wider">Attendance</th>
                                <th class="px-6 py-3 text-right text-xs font-medium text-gray-400 uppercase tracking-wider">Actions</th>
                            </tr>
                        </thead>
                        <tbody class="divide-y divide-gray-700">
                            ${students.length > 0 ? students.map(s => `
                                <tr class="hover:bg-gray-700/50 transition">
                                    <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-300">${s.id}</td>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-200">${s.name}</td>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-400">${s.grade}</td>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm text-white font-bold">${s.overall_score}</td>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm text-green-400">${s.attendance}%</td>
                                    <td class="px-6 py-4 whitespace-nowrap text-right text-sm font-medium">
                                        <button onclick="handleDelete('student', ${s.id})" class="text-red-400 hover:text-red-500 transition p-1 rounded-full hover:bg-gray-700" title="Delete Student">
                                            <i data-lucide="trash-2" class="w-4 h-4"></i>
                                        </button>
                                    </td>
                                </tr>
                            `).join('') : `
                                <tr>
                                    <td colspan="6" class="px-6 py-8 text-center text-gray-400">
                                        <div class="flex flex-col items-center justify-center">
                                            <i data-lucide="users" class="w-12 h-12 mb-2 text-gray-500"></i>
                                            <p>No students found. Add your first student to get started.</p>
                                        </div>
                                    </td>
                                </tr>
                            `}
                        </tbody>
                    </table>
                </div>
            `;
        }

        function renderStaff() {
            const staff = appState.staff || [];

            viewContent.innerHTML = `
                <div class="flex justify-between items-center mb-6">
                    <p class="text-sm text-gray-400">${staff.length} staff members currently employed.</p>
                    <button onclick="showAddForm('staff')" class="flex items-center space-x-2 px-4 py-2 text-sm font-medium text-white gradient-main rounded-xl hover:opacity-90 transition main-shadow">
                        <i data-lucide="plus" class="w-4 h-4"></i>
                        <span>Add Staff</span>
                    </button>
                </div>
                ${renderAddStaffForm()}
                
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                    ${staff.length > 0 ? staff.map(s => `
                        <div class="flex justify-between items-center p-6 bg-gray-800 rounded-xl shadow-lg border border-gray-700 transition duration-150 hover:border-purple-500">
                            <div>
                                <div class="font-semibold text-lg text-white">${s.name}</div>
                                <div class="text-sm text-purple-400">${s.role}</div>
                                <div class="text-xs text-gray-400">${s.department}</div>
                            </div>
                            <button onclick="handleDelete('staff', ${s.id})" class="text-red-400 hover:text-red-500 transition p-2 rounded-full hover:bg-gray-700" title="Delete Staff">
                                <i data-lucide="trash-2" class="w-5 h-5"></i>
                            </button>
                        </div>
                    `).join('') : `
                        <div class="col-span-3 flex flex-col items-center justify-center p-8 bg-gray-800 rounded-xl border border-gray-700">
                            <i data-lucide="user-plus" class="w-16 h-16 mb-4 text-gray-500"></i>
                            <p class="text-gray-400 text-center">No staff members found. Add your first staff member to get started.</p>
                        </div>
                    `}
                </div>
            `;
        }

        function renderProgress() {
            const subjects = appState.progress.subjects || [];
            const chartData = appState.progress.chart;

            viewContent.innerHTML = `
                <h2 class="text-2xl font-semibold mb-4 text-indigo-400">Academic Progress Analysis</h2>

                <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-8">
                    <div class="bg-gray-800 p-6 rounded-xl shadow-lg border border-gray-700">
                        <h3 class="text-xl font-semibold mb-4 text-gray-200">Overall Score Distribution</h3>
                        <div class="h-80">
                            <canvas id="progress-chart-view"></canvas>
                        </div>
                    </div>
                    <div class="bg-gray-800 p-6 rounded-xl shadow-lg border border-gray-700">
                        <h3 class="text-xl font-semibold mb-4 text-gray-200">AI-Powered Improvement Focus</h3>
                        <p class="text-gray-400 mb-4 text-sm">Identifying areas of highest and lowest recent improvement across subjects.</p>
                        <ul class="space-y-3">
                            ${subjects.sort((a, b) => b.improvement - a.improvement).map(s => `
                                <li class="flex justify-between items-center p-3 rounded-lg bg-gray-700/50 border-l-4 ${s.improvement > 0 ? 'border-green-500' : 'border-red-500'}">
                                    <div class="flex flex-col">
                                        <span class="font-medium text-lg text-white">${s.name}</span>
                                        <span class="text-xs text-gray-400">Teacher: ${s.teacher}</span>
                                    </div>
                                    <div class="text-right">
                                        <span class="text-lg font-bold ${s.improvement > 0 ? 'text-green-400' : 'text-red-400'}">${s.improvement.toFixed(1)}%</span>
                                        <span class="text-xs text-gray-500 block">Avg: ${s.average.toFixed(1)}%</span>
                                    </div>
                                </li>
                            `).join('')}
                        </ul>
                    </div>
                </div>
            `;
            if (chartData) {
                initializeChart(chartData, 'progress-chart-view');
            }
        }

        function renderAssessments() {
            const baseline = appState.assessments.baseline || [];
            const midline = appState.assessments.midline || [];
            const endline = appState.assessments.endline || [];
            const studentProgress = appState.assessments.studentProgress || [];

            viewContent.innerHTML = `
                <div class="mb-8">
                    <h2 class="text-2xl font-bold mb-4 text-indigo-400">Student Assessment Dashboard</h2>
                    <p class="text-gray-400 mb-6">Track student progress across baseline, midline, and endline assessments to measure the impact of AI-empowered education.</p>
                    
                    <!-- Assessment Overview Cards -->
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                        <div class="bg-gray-800 p-6 rounded-xl shadow-lg border border-indigo-700 assessment-card">
                            <div class="flex items-center justify-between mb-4">
                                <h3 class="text-lg font-semibold text-indigo-300">Baseline Assessment</h3>
                                <i data-lucide="clipboard-list" class="w-8 h-8 text-indigo-400"></i>
                            </div>
                            <div class="text-3xl font-bold text-white mb-2">${baseline.length}</div>
                            <p class="text-sm text-gray-400">Students assessed at program start</p>
                            <div class="mt-4">
                                <div class="flex justify-between text-xs text-gray-400 mb-1">
                                    <span>Completion</span>
                                    <span>${baseline.filter(s => s.completed).length}/${baseline.length}</span>
                                </div>
                                <div class="progress-bar bg-gray-700">
                                    <div class="baseline-color h-full" style="width: ${(baseline.filter(s => s.completed).length / baseline.length) * 100 || 0}%"></div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="bg-gray-800 p-6 rounded-xl shadow-lg border border-purple-700 assessment-card">
                            <div class="flex items-center justify-between mb-4">
                                <h3 class="text-lg font-semibold text-purple-300">Midline Assessment</h3>
                                <i data-lucide="clipboard-check" class="w-8 h-8 text-purple-400"></i>
                            </div>
                            <div class="text-3xl font-bold text-white mb-2">${midline.length}</div>
                            <p class="text-sm text-gray-400">Students assessed mid-program</p>
                            <div class="mt-4">
                                <div class="flex justify-between text-xs text-gray-400 mb-1">
                                    <span>Completion</span>
                                    <span>${midline.filter(s => s.completed).length}/${midline.length}</span>
                                </div>
                                <div class="progress-bar bg-gray-700">
                                    <div class="midline-color h-full" style="width: ${(midline.filter(s => s.completed).length / midline.length) * 100 || 0}%"></div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="bg-gray-800 p-6 rounded-xl shadow-lg border border-pink-700 assessment-card">
                            <div class="flex items-center justify-between mb-4">
                                <h3 class="text-lg font-semibold text-pink-300">Endline Assessment</h3>
                                <i data-lucide="award" class="w-8 h-8 text-pink-400"></i>
                            </div>
                            <div class="text-3xl font-bold text-white mb-2">${endline.length}</div>
                            <p class="text-sm text-gray-400">Students assessed at program end</p>
                            <div class="mt-4">
                                <div class="flex justify-between text-xs text-gray-400 mb-1">
                                    <span>Completion</span>
                                    <span>${endline.filter(s => s.completed).length}/${endline.length}</span>
                                </div>
                                <div class="progress-bar bg-gray-700">
                                    <div class="endline-color h-full" style="width: ${(endline.filter(s => s.completed).length / endline.length) * 100 || 0}%"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Student Progress Table -->
                    <div class="bg-gray-800 rounded-xl shadow-lg overflow-hidden border border-gray-700 responsive-table">
                        <h3 class="text-xl font-semibold p-6 text-gray-200 border-b border-gray-700">Individual Student Progress</h3>
                        <table class="min-w-full divide-y divide-gray-700">
                            <thead class="bg-gray-700">
                                <tr>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-400 uppercase tracking-wider">Student</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-400 uppercase tracking-wider">Baseline</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-400 uppercase tracking-wider">Midline</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-400 uppercase tracking-wider">Endline</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-400 uppercase tracking-wider">Improvement</th>
                                </tr>
                            </thead>
                            <tbody class="divide-y divide-gray-700">
                                ${studentProgress.length > 0 ? studentProgress.map(s => {
                const baselineScore = s.baseline_score || 0;
                const midlineScore = s.midline_score || 0;
                const endlineScore = s.endline_score || 0;
                const improvement = endlineScore - baselineScore;

                return `
                                    <tr class="hover:bg-gray-700/50 transition">
                                        <td class="px-6 py-4 whitespace-nowrap">
                                            <div class="font-medium text-white">${s.name}</div>
                                            <div class="text-xs text-gray-400">Grade ${s.grade}</div>
                                        </td>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm">
                                            <div class="font-medium ${baselineScore >= 70 ? 'text-green-400' : baselineScore >= 50 ? 'text-yellow-400' : 'text-red-400'}">${baselineScore}%</div>
                                        </td>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm">
                                            <div class="font-medium ${midlineScore >= 70 ? 'text-green-400' : midlineScore >= 50 ? 'text-yellow-400' : 'text-red-400'}">${midlineScore}%</div>
                                        </td>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm">
                                            <div class="font-medium ${endlineScore >= 70 ? 'text-green-400' : endlineScore >= 50 ? 'text-yellow-400' : 'text-red-400'}">${endlineScore}%</div>
                                        </td>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm">
                                            <div class="font-bold ${improvement > 0 ? 'improvement-positive' : 'improvement-negative'}">${improvement > 0 ? '+' : ''}${improvement.toFixed(1)}%</div>
                                        </td>
                                    </tr>
                                    `;
            }).join('') : `
                                    <tr>
                                        <td colspan="5" class="px-6 py-8 text-center text-gray-400">
                                            <div class="flex flex-col items-center justify-center">
                                                <i data-lucide="clipboard-check" class="w-12 h-12 mb-2 text-gray-500"></i>
                                                <p>No assessment data available. Add students to see their progress.</p>
                                            </div>
                                        </td>
                                    </tr>
                                `}
                            </tbody>
                        </table>
                    </div>
                </div>
            `;
        }

        function renderAIEducation() {
            viewContent.innerHTML = `
                <div class="max-w-6xl mx-auto">
                    <!-- Hero Section -->
                    <div class="bg-gradient-to-r from-indigo-900 via-purple-900 to-pink-900 rounded-2xl p-8 mb-8 text-center shadow-2xl">
                        <h1 class="text-3xl md:text-4xl font-bold mb-4 text-white">Introducing AI in Early Education</h1>
                        <p class="text-xl text-indigo-200 mb-6">A Comprehensive Guide for Principals and Educators</p>
                    </div>

                    <!-- Why AI in Early Education -->
                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 mb-12">
                        <div class="bg-gray-800 p-6 rounded-xl shadow-lg border border-indigo-700">
                            <h2 class="text-2xl font-bold mb-4 text-indigo-300">Why Start Early?</h2>
                            <ul class="space-y-3">
                                <li class="flex items-start">
                                    <i data-lucide="check-circle" class="w-5 h-5 text-green-400 mr-2 mt-1"></i>
                                    <span class="text-gray-300">Natural curiosity helps children adapt quickly</span>
                                </li>
                                <li class="flex items-start">
                                    <i data-lucide="check-circle" class="w-5 h-5 text-green-400 mr-2 mt-1"></i>
                                    <span class="text-gray-300">Builds digital literacy foundations</span>
                                </li>
                                <li class="flex items-start">
                                    <i data-lucide="check-circle" class="w-5 h-5 text-green-400 mr-2 mt-1"></i>
                                    <span class="text-gray-300">Personalized learning from the start</span>
                                </li>
                                <li class="flex items-start">
                                    <i data-lucide="check-circle" class="w-5 h-5 text-green-400 mr-2 mt-1"></i>
                                    <span class="text-gray-300">Prepares children for an AI-driven future</span>
                                </li>
                            </ul>
                        </div>

                        <div class="bg-gray-800 p-6 rounded-xl shadow-lg border border-purple-700">
                            <h2 class="text-2xl font-bold mb-4 text-purple-300">Implementation Roadmap</h2>
                            <ul class="space-y-3">
                                <li class="flex items-start">
                                    <div class="bg-purple-600 text-white px-2 py-1 rounded text-xs font-bold mr-3">1-2 Mo</div>
                                    <span class="text-gray-300">Staff training & parent workshops</span>
                                </li>
                                <li class="flex items-start">
                                    <div class="bg-purple-600 text-white px-2 py-1 rounded text-xs font-bold mr-3">3 Mo</div>
                                    <span class="text-gray-300">Pilot programs with small groups</span>
                                </li>
                                <li class="flex items-start">
                                    <div class="bg-purple-600 text-white px-2 py-1 rounded text-xs font-bold mr-3">4 Mo</div>
                                    <span class="text-gray-300">Expand to all classrooms</span>
                                </li>
                                <li class="flex items-start">
                                    <div class="bg-purple-600 text-white px-2 py-1 rounded text-xs font-bold mr-3">5-6 Mo</div>
                                    <span class="text-gray-300">Full implementation & evaluation</span>
                                </li>
                            </ul>
                        </div>
                    </div>

                    <!-- Success Metrics -->
                    <div class="bg-gray-800 p-6 rounded-xl shadow-lg border border-gray-700 mb-8">
                        <h2 class="text-2xl font-bold mb-6 text-center text-white">Success Metrics</h2>
                        <div class="grid grid-cols-2 md:grid-cols-4 gap-6">
                            <div class="text-center p-4 bg-gray-700/50 rounded-lg">
                                <div class="text-3xl font-bold text-green-400 mb-2">85%</div>
                                <div class="text-sm text-gray-300">Student Engagement</div>
                            </div>
                            <div class="text-center p-4 bg-gray-700/50 rounded-lg">
                                <div class="text-3xl font-bold text-blue-400 mb-2">92%</div>
                                <div class="text-sm text-gray-300">Teacher Confidence</div>
                            </div>
                            <div class="text-center p-4 bg-gray-700/50 rounded-lg">
                                <div class="text-3xl font-bold text-purple-400 mb-2">78%</div>
                                <div class="text-sm text-gray-300">Parent Satisfaction</div>
                            </div>
                            <div class="text-center p-4 bg-gray-700/50 rounded-lg">
                                <div class="text-3xl font-bold text-yellow-400 mb-2">45%</div>
                                <div class="text-sm text-gray-300">Learning Acceleration</div>
                            </div>
                        </div>
                    </div>

                    <!-- Call to Action -->
                    <div class="text-center">
                        <button onclick="downloadAIResources()" class="px-6 py-3 bg-gradient-to-r from-indigo-600 to-purple-600 text-white font-semibold rounded-xl hover:opacity-90 transition shadow-lg">
                            <i data-lucide="download" class="w-5 h-5 inline mr-2"></i>
                            Download Implementation Guide
                        </button>
                    </div>
                </div>
            `;
            lucide.createIcons();
        }

        function downloadAIResources() {
            showModal("Resources Downloaded", "The AI Implementation Guide has been downloaded to your device.");
        }

        // Form rendering
        function showAddForm(type) {
            const formContainer = document.getElementById(type === 'student' ? 'add-student-form-container' : 'add-staff-form-container');
            const isHidden = formContainer.classList.contains('hidden');
            if (isHidden) {
                formContainer.classList.remove('hidden');
            } else {
                formContainer.classList.add('hidden');
            }
        }

        function renderAddStudentForm() {
            return `
                <div id="add-student-form-container" class="hidden bg-gray-800 p-6 rounded-xl shadow-lg mb-8 border border-gray-700">
                    <h3 class="text-xl font-semibold mb-4 text-indigo-400">Add New Student</h3>
                    <form onsubmit="handleCreate(event, 'student')" class="grid grid-cols-1 md:grid-cols-4 gap-4">
                        <div class="flex flex-col space-y-1">
                            <label for="name" class="text-xs font-medium text-gray-300">Full Name *</label>
                            <input type="text" id="name" name="name" required
                                class="px-3 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white placeholder-gray-500 focus:ring-indigo-500 focus:border-indigo-500 transition">
                        </div>
                        <div class="flex flex-col space-y-1">
                            <label for="grade" class="text-xs font-medium text-gray-300">Grade Level *</label>
                            <input type="text" id="grade" name="grade" required
                                class="px-3 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white placeholder-gray-500 focus:ring-indigo-500 focus:border-indigo-500 transition">
                        </div>
                        <div class="flex flex-col space-y-1">
                            <label for="score" class="text-xs font-medium text-gray-300">Overall Score (0-100)</label>
                            <input type="number" id="score" name="score"
                                class="px-3 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white placeholder-gray-500 focus:ring-indigo-500 focus:border-indigo-500 transition">
                        </div>
                        <div class="flex flex-col space-y-1">
                            <label for="attendance" class="text-xs font-medium text-gray-300">Attendance (%)</label>
                            <input type="number" id="attendance" name="attendance"
                                class="px-3 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white placeholder-gray-500 focus:ring-indigo-500 focus:border-indigo-500 transition">
                        </div>
                        <button type="submit" class="col-span-1 md:col-span-4 px-4 py-2 text-sm font-medium text-white gradient-main rounded-lg hover:opacity-90 transition">
                            Create Student
                        </button>
                    </form>
                </div>
            `;
        }

        function renderAddStaffForm() {
            return `
                <div id="add-staff-form-container" class="hidden bg-gray-800 p-6 rounded-xl shadow-lg mb-8 border border-gray-700">
                    <h3 class="text-xl font-semibold mb-4 text-purple-400">Add New Staff Member</h3>
                    <form onsubmit="handleCreate(event, 'staff')" class="grid grid-cols-1 md:grid-cols-3 gap-4">
                        <div class="flex flex-col space-y-1">
                            <label for="name" class="text-xs font-medium text-gray-300">Full Name *</label>
                            <input type="text" id="name" name="name" required
                                class="px-3 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white placeholder-gray-500 focus:ring-indigo-500 focus:border-indigo-500 transition">
                        </div>
                        <div class="flex flex-col space-y-1">
                            <label for="role" class="text-xs font-medium text-gray-300">Role *</label>
                            <input type="text" id="role" name="role" required
                                class="px-3 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white placeholder-gray-500 focus:ring-indigo-500 focus:border-indigo-500 transition">
                        </div>
                        <div class="flex flex-col space-y-1">
                            <label for="department" class="text-xs font-medium text-gray-300">Department *</label>
                            <input type="text" id="department" name="department" required
                                class="px-3 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white placeholder-gray-500 focus:ring-indigo-500 focus:border-indigo-500 transition">
                        </div>
                        <button type="submit" class="col-span-1 md:col-span-3 px-4 py-2 text-sm font-medium text-white gradient-main rounded-lg hover:opacity-90 transition">
                            Create Staff
                        </button>
                    </form>
                </div>
            `;
        }

        async function handleCreate(event, type) {
            event.preventDefault();
            const form = event.target;
            const formData = new FormData(form);

            const newItem = {};
            for (let [key, value] of formData.entries()) {
                newItem[key] = value;
            }

            newItem.id = Date.now();

            if (type === 'student') {
                newItem.overall_score = parseInt(newItem.score) || 0;
                newItem.attendance = parseInt(newItem.attendance) || 0;
                delete newItem.score;

                appState.students.push(newItem);

                const baselineScore = Math.max(0, newItem.overall_score - 10 + Math.floor(Math.random() * 20));
                const midlineScore = Math.max(0, newItem.overall_score - 5 + Math.floor(Math.random() * 15));

                appState.assessments.studentProgress.push({
                    id: newItem.id,
                    name: newItem.name,
                    grade: newItem.grade,
                    baseline_score: baselineScore,
                    midline_score: midlineScore,
                    endline_score: newItem.overall_score
                });
            } else if (type === 'staff') {
                appState.staff.push(newItem);
            }

            saveAppState();

            showModal("Success!", `${newItem.name} has been added successfully.`);
            form.reset();

            loadData();
        }

        async function handleDelete(type, id) {
            const itemType = type === 'student' ? 'Student' : 'Staff Member';
            const success = await showModal(
                "Confirm Deletion",
                `Are you sure you want to delete this ${itemType.toLowerCase()}? This action cannot be undone.`,
                true
            );

            if (!success) return;

            if (type === 'student') {
                appState.students = appState.students.filter(s => s.id !== id);
                appState.assessments.studentProgress = appState.assessments.studentProgress.filter(s => s.id !== id);
            } else if (type === 'staff') {
                appState.staff = appState.staff.filter(s => s.id !== id);
            }

            saveAppState();

            showModal("Success", `${itemType} deleted successfully.`);
            loadData();
        }

        // Chart.js integration
        let activeChart = null;

        function initializeChart(chartData, canvasId = 'average-scores-chart') {
            if (activeChart) {
                activeChart.destroy();
            }

            const ctx = document.getElementById(canvasId);
            if (!ctx) return;

            activeChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: chartData.labels,
                    datasets: [{
                        label: chartData.datasets[0].label,
                        data: chartData.datasets[0].data,
                        backgroundColor: chartData.datasets[0].backgroundColor,
                        borderColor: chartData.datasets[0].borderColor,
                        borderWidth: chartData.datasets[0].borderWidth,
                        borderRadius: 6
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true,
                            max: 100,
                            ticks: { color: '#9ca3af' },
                            grid: { color: '#374151' }
                        },
                        x: {
                            ticks: { color: '#9ca3af' },
                            grid: { display: false }
                        }
                    },
                    plugins: {
                        legend: { display: false },
                        title: { display: false }
                    }
                }
            });
        }

        // Initialize app
        window.onload = function () {
            lucide.createIcons();
            setupMobileMenu();
            initializeAppState();
            changeView('dashboard');
        };
    </script>
</body>

</html>